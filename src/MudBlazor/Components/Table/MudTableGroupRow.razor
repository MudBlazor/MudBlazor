@namespace MudBlazor
@implements IDisposable
@inherits MudComponentBase
@typeparam T

@*HEADER:*@
@if (HeaderTemplate != null && GroupDefinition != null)
{
<tr class="@HeaderClassname" @onclick="@OnRowClick" style="@HeaderStyle" @attributes="@UserAttributes">        
    @if ((Context?.Table.MultiSelection ?? false))
    {
        <MudTd>
            @if (IsCheckable)
            {
                <MudCheckBox @bind-Checked="IsChecked" />
            }
        </MudTd>
    }
    @if (GroupDefinition?.Expandable ?? false)
    {
        <MudTd Class="pa-0">
            <MudIconButton Class="ma-0" Icon="@(IsExpanded ? Icons.Material.Filled.Remove : Icons.Material.Filled.Add)" OnClick="@(() => IsExpanded = !IsExpanded)" />
        </MudTd>
    }
    @HeaderTemplate(new TableGroupData<object, T>(GroupDefinition.GroupName, Items.Key, Items.ToList()))
    @if ((Context?.Table.IsEditable ?? false))
    {
        <MudTd />
    }
</tr>
}
else
{
<MudText @attributes="@UserAttributes">@("There aren't any group definition to use with this component.")</MudText>
}

@if (IsExpanded)
{
    @*CHILDREN:*@
    @if (_innerGroupItems != null && GroupDefinition != null)
    {
        @foreach (var group in _innerGroupItems)
        {
            <MudTableGroupRow GroupDefinition="GroupDefinition.InnerGroup" Items="@group" IsCheckable="@IsCheckable"
                              HeaderClass="@HeaderClassname" HeaderStyle="@HeaderStyle"
                              FooterClass="@FooterClass" FooterStyle="@FooterStyle"
                              HeaderTemplate="@HeaderTemplate" FooterTemplate="@FooterTemplate" T="T" @attributes="@UserAttributes" />
        }
    }
    else
    {
        @Table?.RenderRows(Items, (GroupDefinition?.Indentation ?? false) ? $"mud-table-row-group-indented-{GroupDefinition?.Level}" : null, GroupDefinition?.Expandable ?? false)
    }

    @*FOOTER:*@
    @if (FooterTemplate != null && GroupDefinition != null)
    {
        <tr class="@FooteerClassname" @onclick="@OnRowClick" style="@FooterStyle" @attributes="@UserAttributes">
            @if ((Context?.Table.MultiSelection ?? false))
            {
                <MudTd/>
            }
            @if (GroupDefinition?.Expandable ?? false)
            {
                <MudTd/>
            }
            @FooterTemplate(new TableGroupData<object, T>(GroupDefinition.GroupName, Items.Key, Items.ToList()))
            @if ((Context?.Table.IsEditable ?? false))
            {
                <MudTd/>
            }
        </tr>
    }
}