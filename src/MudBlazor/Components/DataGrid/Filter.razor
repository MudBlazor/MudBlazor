@namespace MudBlazor
@typeparam T

<MudItem xs="1" Class="d-flex">
    <MudIconButton Icon="@Icons.Material.Filled.Close" OnClick="@RemoveFilter" Size="@Size.Small" Style="align-self:flex-end"></MudIconButton>
</MudItem>
<MudItem xs="4">
    <MudSelect T="string" @bind-Value="@_field" FullWidth="true" Label="Column" Dense="true" Margin="@Margin.Dense">
        @if (DataGrid?._columns != null)
        {
            @foreach (var column in DataGrid?._columns)
            {
                if (column.Filterable == null || (column.Filterable.HasValue && column.Filterable.Value))
                {
                    <MudSelectItem Value="@column.Field">@(String.IsNullOrEmpty(column.Title) ? column.Field : column.Title)</MudSelectItem>
                }
            }
        }
    </MudSelect>
</MudItem>
<MudItem xs="3">
    <MudSelect @bind-Value="_operator" FullWidth="true" Label="Operator" Dense="true" Margin="@Margin.Dense">
        @foreach (var o in FilterOperator.GetOperatorByDataType(dataType))
        {
            <MudSelectItem Value="@o">@o</MudSelectItem>
        }
    </MudSelect>
</MudItem>
<MudItem xs="4">
    @if (dataType == typeof(string) && !(_operator ?? "").EndsWith("empty"))
    {
        <MudTextField T="string" Value="@_valueString" ValueChanged="@StringValueChanged" FullWidth="true" Label="Value" Placeholder="Filter value" Margin="@Margin.Dense" Immediate="true"></MudTextField>
    }
    else if (isNumber && !(_operator ?? "").EndsWith("empty"))
    {
        <MudNumericField T="double?" Value="@_valueNumber" ValueChanged="@NumberValueChanged" FullWidth="true" Label="Value" Placeholder="Filter value" Margin="@Margin.Dense" Immediate="true"></MudNumericField>
    }
    else if (IsEnumFlags)
    {
        <MudSelect T="Enum" SelectedValuesChanged="@EnumFlagsValueChanged" FullWidth="true" Dense="true" Margin="@Margin.Dense" MultiSelection=true>
            @if (dataType != null && dataType.IsEnum)
            {
                foreach (var item in Enum.GetValues(dataType))
                {
                    if (Convert.ToUInt64(item) != 0)
                    {
                        <MudSelectItem T="Enum" Value="@((Enum)item)">@item</MudSelectItem>
                    }
                }
            }
        </MudSelect>
    }
    else if (isEnum)
    {
        <MudSelect T="Enum" Value="@_valueEnum" ValueChanged="@EnumValueChanged" FullWidth="true" Dense="true" Margin="@Margin.Dense">
            <MudSelectItem T="Enum" Value="@(null)">@("<null>")</MudSelectItem>
            @foreach (var item in Enum.GetValues(dataType))
            {
                <MudSelectItem T="Enum" Value="@((Enum)item)">@item</MudSelectItem>
            }
        </MudSelect>
    }
    else if (dataType == typeof(bool))
    {
        <MudSelect T="bool?" Value="@_valueBool" ValueChanged="@BoolValueChanged" FullWidth="true" Dense="true" Margin="@Margin.Dense">
            <MudSelectItem T="bool?" Value="@(null)">@("<null>")</MudSelectItem>
            <MudSelectItem T="bool?" Value="@(true)">true</MudSelectItem>
            <MudSelectItem T="bool?" Value="@(false)">false</MudSelectItem>
        </MudSelect>
    }
    else if (dataType == typeof(DateTime) && !(_operator ?? "").EndsWith("empty"))
    {
        <MudGrid Spacing="0">
            <MudItem xs="7">
                <MudDatePicker Date="@_valueDate" DateChanged="@DateValueChanged" Margin="@Margin.Dense" />
            </MudItem>
            <MudItem xs="5">
                <MudTimePicker Time="@_valueTime" TimeChanged="@TimeValueChanged" Margin="@Margin.Dense" />
            </MudItem>
        </MudGrid>
    }
    </MudItem>