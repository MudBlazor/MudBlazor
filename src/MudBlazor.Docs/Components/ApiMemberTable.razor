@using MudBlazor.Docs.Extensions
@using Services.XmlDocs
@using System.Reflection

<MudTable T="MemberInfo" @ref="Table" ServerData="GetData"
          RowsPerPage="9999" Hover="true" Dense="true" AllowUnsorted="false"
          Elevation="0" Class="ma-0 mud-width-full"
          GroupBy="@CurrentGroups">
    <ToolBarContent>
        <MudGrid>
            <MudItem xs="6">
                <MudButtonGroup OverrideStyles="false">
                    <MudButton Color="Color.Primary" Variant="@GetButtonVariant(ApiMemberGrouping.Categories)" OnClick="@(() => OnGroupBy(ApiMemberGrouping.Categories))">Category</MudButton>
                    <MudButton Color="Color.Primary" Variant="@GetButtonVariant(ApiMemberGrouping.Inheritance)" OnClick="@(() => OnGroupBy(ApiMemberGrouping.Inheritance))">Inheritance</MudButton>
                    <MudButton Color="Color.Primary" Variant="@GetButtonVariant(ApiMemberGrouping.None)" OnClick="@(() => OnGroupBy(ApiMemberGrouping.None))">None</MudButton>
                </MudButtonGroup>
            </MudItem>
        </MudGrid>
    </ToolBarContent>
    <GroupHeaderTemplate>
        @if (Grouping == ApiMemberGrouping.Inheritance)
        {
            <MudTh Class="mud-table-cell-custom-group" colspan="3">
                <MudText Typo="Typo.h6">@context.Key</MudText>
            </MudTh>
        }
        else if (Grouping == ApiMemberGrouping.Categories)
        {
            <MudTh Class="mud-table-cell-custom-group" colspan="3">
                <MudText Typo="Typo.h6">@(context.Key ?? "General")</MudText>
            </MudTh>
        }
    </GroupHeaderTemplate>
    <HeaderContent>
        <MudTh><MudTableSortLabel T="MemberInfo" SortLabel="Name" InitialDirection="SortDirection.Ascending">Name</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel T="MemberInfo" SortLabel="Type">Type</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel T="MemberInfo" SortLabel="Description">Description</MudTableSortLabel></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Name">
            @if (context.DeclaringType != null && context.DeclaringType.Name != Type.Name)
            {
                <MudTooltip Text="@("From " + context.DeclaringType.GetFriendlyName())" Placement="Placement.Top">
                    <CodeInline>@context.Name</CodeInline>
                </MudTooltip>
            }
            else
            {
                <CodeInline>@context.Name</CodeInline>
            }
        </MudTd>
        <MudTd DataLabel="Type">
            @if (Mode == ApiMemberType.Properties)
            {
                var property = context as PropertyInfo;
                <ApiTypeLink TypeFullName="@property.PropertyType.FullName" />
            }
            else if (Mode == ApiMemberType.Methods)
            {
                var method = context as MethodInfo;
                <ApiTypeLink TypeFullName="@method.ReturnType.FullName" />
            }
            else if (Mode == ApiMemberType.Fields)
            {
                var field = context as FieldInfo;
                <ApiTypeLink TypeFullName="@field.FieldType.FullName" />
            }
            else if (Mode == ApiMemberType.Events)
            {
                var eventItem = context as EventInfo;
                var field = context as FieldInfo;
                var property = context as PropertyInfo;
                if (eventItem != null)
                {
                    <ApiTypeLink TypeFullName="@eventItem.EventHandlerType.FullName" />
                }
                else if (field != null)
                {
                    <ApiTypeLink TypeFullName="@field.FieldType.FullName" />
                }
                else if (property != null)
                {
                    <ApiTypeLink TypeFullName="@property.PropertyType.FullName" />
                }
            }
        </MudTd>
        <MudTd DataLabel="Description">
            @* <ApiText Context="@Type" Comments="@Docs.GetMemberCommentsAsync(context)" /> *@
        </MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudAlert Severity="Severity.Info">No members match the current filters.</MudAlert>
    </NoRecordsContent>
</MudTable>
